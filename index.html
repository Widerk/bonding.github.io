<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluid Shape Pro | Engineering Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b0f1a;
            --card: #161c2d;
            --accent: #3b82f6;
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: #e2e8f0;
            overflow-x: hidden;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass {
            background: rgba(22, 28, 45, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- FIX CRÍTICO PARA SLICERS (DESLIZADORES) --- */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            height: 32px; /* Área táctil mayor */
        }

        input[type=range]:focus {
            outline: none;
        }

        /* Estilo de la barra (Track) */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #1e293b;
            border-radius: 10px;
            border: 1px solid #334155;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #1e293b;
            border-radius: 10px;
            border: 1px solid #334155;
        }

        /* Estilo del Botón (Thumb) */
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff; /* Blanco para contraste total */
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -7px; /* Centrado vertical */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8), 0 0 2px rgba(0,0,0,0.5);
            border: 2px solid #3b82f6;
        }
        input[type=range]::-moz-range-thumb {
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
            border: 2px solid #3b82f6;
        }

        .metric-change { animation: pulse 0.3s ease-out; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); color: #60a5fa; }
            100% { transform: scale(1); }
        }

        /* Custom scrollbar para el panel de controles */
        #controls-container::-webkit-scrollbar { width: 4px; }
        #controls-container::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 lg:p-6">
    <div class="max-w-[1600px] mx-auto">
        <!-- Navbar -->
        <nav class="flex items-center justify-between mb-6 glass rounded-2xl px-6 py-4 border-b border-white/5">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <i data-lucide="layers" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-lg font-extrabold tracking-tight">FLUID SHAPE <span class="text-blue-500 italic">PRO</span></h1>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest text-xs">Análisis de Longitud Diferencial</p>
                </div>
            </div>
            <button onclick="exportData()" class="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-xs font-bold transition-all">
                <i data-lucide="download" size="14"></i> EXPORTAR
            </button>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Sidebar Izquierdo: Controles -->
            <aside class="lg:col-span-3 space-y-4">
                <div class="glass rounded-[2rem] p-6 shadow-2xl flex flex-col max-h-[85vh]">
                    <div class="flex items-center gap-2 mb-6 text-blue-400">
                        <i data-lucide="sliders-horizontal" size="18"></i>
                        <h2 class="text-xs font-black uppercase tracking-[0.2em]">Parámetros de Diseño</h2>
                    </div>

                    <div id="controls-container" class="space-y-6 overflow-y-auto pr-2">
                        <div id="dynamic-sliders" class="space-y-6">
                            <!-- Inyectado por JS (A-E) -->
                        </div>

                        <!-- Sección de Longitud Diferencial -->
                        <div class="pt-6 border-t border-white/10 space-y-4">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest block">Análisis Longitudinal (m)</label>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-slate-900/50 p-2 rounded-xl border border-white/5">
                                    <span class="text-[9px] text-slate-500 block">INICIAL</span>
                                    <input type="number" id="l_start" value="10" step="0.1" oninput="updateCalculations()" class="w-full bg-transparent text-sm font-mono text-blue-400 outline-none">
                                </div>
                                <div class="bg-slate-900/50 p-2 rounded-xl border border-white/5">
                                    <span class="text-[9px] text-slate-500 block">FINAL</span>
                                    <input type="number" id="l_end" value="80" step="0.1" oninput="updateCalculations()" class="w-full bg-transparent text-sm font-mono text-blue-400 outline-none">
                                </div>
                            </div>
                            <div class="bg-blue-500/10 p-2 rounded-xl border border-blue-500/20 text-center">
                                <span class="text-[10px] text-blue-400 font-bold uppercase">Longitud Neta: </span>
                                <span id="l_net_display" class="font-mono text-sm font-bold text-white">70.00 m</span>
                            </div>
                        </div>

                        <!-- Material -->
                        <div class="pt-4 space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Material / Fluido</label>
                            <select id="materialSelect" onchange="updateMaterial()" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-xs text-slate-300 outline-none focus:border-blue-500">
                                <option value="1121.7">Personalizado (1121.7 kg/m³)</option>
                                <option value="1000">Agua Dulce (1000 kg/m³)</option>
                                <option value="1025">Agua Salada (1025 kg/m³)</option>
                                <option value="920">Aceite (920 kg/m³)</option>
                                <option value="7850">Acero (7850 kg/m³)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Visualizador Central -->
            <div class="lg:col-span-6">
                <div class="glass rounded-[3rem] p-4 border border-white/10 shadow-inner h-full flex flex-col">
                    <div id="canvasContainer" class="flex-grow bg-[#050810] rounded-[2.5rem] relative flex items-center justify-center overflow-hidden">
                        <svg id="svgMain" viewBox="0 0 300 300" class="w-[90%] h-[90%]" style="transform: scaleY(-1);">
                            <defs>
                                <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                    <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#1e293b" stroke-width="0.3"/>
                                </pattern>
                                <linearGradient id="shapeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.4" />
                                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.1" />
                                </linearGradient>
                            </defs>
                            <rect x="-500" y="-500" width="1000" height="1000" fill="url(#grid)" />
                            <polygon id="shapePoly" fill="url(#shapeGrad)" stroke="#3b82f6" stroke-width="2.5" stroke-linejoin="round" />
                            <g id="cotasGroup"></g>
                            <circle id="centroid" r="4" fill="#f43f5e" stroke="#fff" stroke-width="1.5" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Métricas Derecha -->
            <aside class="lg:col-span-3 space-y-4">
                <h2 class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-2">Métricas de Ingeniería</h2>
                
                <div class="space-y-4">
                    <div class="glass p-5 rounded-3xl border-l-4 border-l-blue-500">
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Área de Sección</p>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span id="m-area" class="text-2xl font-black font-mono text-white">0</span>
                            <span class="text-xs text-slate-600 font-bold uppercase">mm²</span>
                        </div>
                    </div>

                    <div class="glass p-5 rounded-3xl border-l-4 border-l-cyan-500">
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Radio Hidráulico</p>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span id="m-rh" class="text-2xl font-black font-mono text-white">0</span>
                            <span class="text-xs text-slate-600 font-bold uppercase">mm</span>
                        </div>
                    </div>

                    <div class="glass p-5 rounded-3xl border-l-4 border-l-emerald-500">
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Volumen (L. Neta)</p>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span id="m-vol" class="text-2xl font-black font-mono text-white">0</span>
                            <span class="text-xs text-slate-600 font-bold uppercase">cm³</span>
                        </div>
                    </div>

                    <div class="glass p-5 rounded-3xl border-l-4 border-l-rose-500">
                        <p class="text-[10px] font-bold text-slate-500 uppercase">Masa del Fluido</p>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span id="m-mass" class="text-2xl font-black font-mono text-white">0.000</span>
                            <span class="text-xs text-slate-600 font-bold uppercase">kg</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const params = { A: 104, B: 40, C: 17, D: 20, E: 52 };
        const labelsMap = { A: 'Base (A)', B: 'Pico (B)', C: 'Altura L (C)', D: 'Altura R (D)', E: 'Posición (E)' };
        let currentDensity = 1121.7;

        function init() {
            lucide.createIcons();
            renderControls();
            updateCalculations();
        }

        function renderControls() {
            const container = document.getElementById('dynamic-sliders');
            container.innerHTML = '';
            Object.keys(params).forEach(key => {
                const div = document.createElement('div');
                div.className = 'group flex flex-col gap-1';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <label class="text-[10px] font-bold text-slate-400 group-hover:text-blue-400 transition-colors uppercase tracking-tight">${labelsMap[key]}</label>
                        <div class="flex items-center gap-1 bg-slate-900 px-2 py-0.5 rounded-lg border border-white/10">
                            <input type="number" value="${params[key]}" step="1" 
                                oninput="syncParam('${key}', this.value, 'range')"
                                id="num-${key}"
                                class="w-10 bg-transparent text-right font-mono text-blue-500 outline-none text-xs font-bold">
                            <span class="text-[8px] text-slate-600 font-bold">MM</span>
                        </div>
                    </div>
                    <input type="range" min="0" max="250" value="${params[key]}" 
                        id="range-${key}"
                        oninput="syncParam('${key}', this.value, 'num')" 
                        class="w-full">
                `;
                container.appendChild(div);
            });
        }

        function syncParam(key, val, targetType) {
            const numVal = parseFloat(val) || 0;
            params[key] = numVal;
            
            // Sincronizar el otro input del mismo parámetro
            if (targetType === 'range') {
                document.getElementById(`range-${key}`).value = numVal;
            } else {
                document.getElementById(`num-${key}`).value = numVal;
            }
            
            updateCalculations();
        }

        function updateMaterial() {
            currentDensity = parseFloat(document.getElementById('materialSelect').value);
            updateCalculations();
        }

        function updateCalculations() {
            const { A, B, C, D, E } = params;
            
            // Cálculo de Longitud Diferencial (L_Final - L_Inicial)
            const lStart = parseFloat(document.getElementById('l_start').value) || 0;
            const lEnd = parseFloat(document.getElementById('l_end').value) || 0;
            const LNeta = Math.max(0, lEnd - lStart);
            document.getElementById('l_net_display').innerText = `${LNeta.toFixed(2)} m`;

            // Puntos de la geometría
            const points = [[0, 0], [A, 0], [A, D], [E, B], [0, C]];
            
            let area = 0, perim = 0, cx = 0, cy = 0;
            for (let i = 0; i < points.length; i++) {
                const [x1, y1] = points[i];
                const [x2, y2] = points[(i + 1) % points.length];
                const common = (x1 * y2 - x2 * y1);
                area += common;
                perim += Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
                cx += (x1 + x2) * common;
                cy += (y1 + y2) * common;
            }
            area = Math.abs(area) / 2;
            cx = Math.abs(cx / (6 * area)) || 0;
            cy = Math.abs(cy / (6 * area)) || 0;

            // Volumen y Masa basados en Longitud Neta
            const volCm3 = (area * (LNeta * 1000)) / 1000;
            const massKg = (volCm3 / 1000) * (currentDensity / 1000);

            // Actualizar UI
            updateMetricDisplay('m-area', area.toFixed(1));
            updateMetricDisplay('m-rh', (perim > 0 ? area / perim : 0).toFixed(2));
            updateMetricDisplay('m-vol', volCm3.toLocaleString(undefined, {maximumFractionDigits: 0}));
            updateMetricDisplay('m-mass', massKg.toFixed(3));

            // Actualizar Dibujo
            document.getElementById('shapePoly').setAttribute('points', points.map(p => p.join(',')).join(' '));
            document.getElementById('centroid').setAttribute('cx', cx);
            document.getElementById('centroid').setAttribute('cy', cy);

            const svg = document.getElementById('svgMain');
            const padding = 50;
            const viewW = A + padding * 2;
            const viewH = Math.max(B, C, D) + padding * 2;
            svg.setAttribute('viewBox', `${-padding} ${-padding} ${viewW} ${viewH}`);
            
            drawCotas(A, B, C, D, E);
        }

        function drawCotas(A, B, C, D, E) {
            const group = document.getElementById('cotasGroup');
            group.innerHTML = '';
            const color = "rgba(148, 163, 184, 0.4)";
            const textColor = "#94a3b8";

            const createLine = (x1, y1, x2, y2) => {
                const l = document.createElementNS("http://www.w3.org/2000/svg", "line");
                l.setAttribute("x1", x1); l.setAttribute("y1", y1);
                l.setAttribute("x2", x2); l.setAttribute("y2", y2);
                l.setAttribute("stroke", color); l.setAttribute("stroke-width", "0.8");
                return l;
            };

            const createText = (x, y, txt, rotate = 0) => {
                const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
                t.setAttribute("x", x); t.setAttribute("y", -y);
                t.setAttribute("fill", textColor);
                t.setAttribute("font-size", "7px");
                t.setAttribute("font-family", "monospace");
                t.setAttribute("text-anchor", "middle");
                t.setAttribute("transform", `scale(1, -1) rotate(${rotate}, ${x}, ${-y})`);
                t.textContent = txt;
                return t;
            };

            // Cota Base A
            group.appendChild(createLine(0, -15, A, -15));
            group.appendChild(createLine(0, -12, 0, -18));
            group.appendChild(createLine(A, -12, A, -18));
            group.appendChild(createText(A/2, -22, `A: ${A}`));

            // Cota Altura C
            group.appendChild(createLine(-15, 0, -15, C));
            group.appendChild(createLine(-12, 0, -18, 0));
            group.appendChild(createLine(-12, C, -18, C));
            group.appendChild(createText(-24, C/2, `C: ${C}`, -90));

            // Cota Altura D
            group.appendChild(createLine(A + 15, 0, A + 15, D));
            group.appendChild(createLine(A + 12, 0, A + 18, 0));
            group.appendChild(createLine(A + 12, D, A + 18, D));
            group.appendChild(createText(A + 24, D/2, `D: ${D}`, 90));

            // Línea de referencia Pico B
            group.appendChild(createLine(E, 0, E, B));
            const dashLine = createLine(E, 0, E, B);
            dashLine.setAttribute("stroke-dasharray", "2,2");
            group.appendChild(dashLine);
            group.appendChild(createText(E, B + 10, `B: ${B}`));
        }

        function updateMetricDisplay(id, value) {
            const el = document.getElementById(id);
            if (el.innerText !== value) {
                el.innerText = value;
                el.classList.remove('metric-change');
                void el.offsetWidth;
                el.classList.add('metric-change');
            }
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                geometria: params,
                analisis: {
                    longitud_inicial: document.getElementById('l_start').value,
                    longitud_final: document.getElementById('l_end').value,
                    longitud_neta: document.getElementById('l_net_display').innerText,
                    area: document.getElementById('m-area').innerText,
                    masa: document.getElementById('m-mass').innerText
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte_fluido_${Date.now()}.json`;
            a.click();
        }

        window.onload = init;
    </script>
</body>
</html>